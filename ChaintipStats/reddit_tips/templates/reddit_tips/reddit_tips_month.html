{% extends 'reddit_tips/base.html' %}

{% block content %}
        <div id = "refresh_date_group">
            <div class = "auto_refresh_box">
                <div class='tooltip'>
                    <p class="round_day_switcher">?</p>
                    <p class="tooltiptext">Data is automatically retrieved from Reddit and CoinMarketCap once an hour. Enabling the auto-refresh box will automatically reload the page with any newly retrieved data. This is useful for a setting up a live monitor.</p>
                </div>
                <div>
                    <p>Auto Refresh:</p>
                </div>
                <div>
                    <input type="checkbox" id="checkbox_autoupdate" onclick="checkbox_click()" unchecked/>
                </div>
                <div>
                    <label id="auto_update_label" for="checkbox_autoupdate"></label>
                </div>
            </div>


            <div id ="date_selector">
                <form id = "date_form" method="GET" action=".">
                    <a href="#" class="round_day_switcher" onclick="date_changer('yesterday')"><</a>
                    <label for="date_start">Date:</label>
                    <input type="month" name="date_start" id="date_start" min={{ month_stats.first_tip_date }} max={{ month_stats.last_tip_date }}>
                    <a href="#" id = "next_day_switcher" class="round_day_switcher" onclick="date_changer('tomorrow')">></a>
                    <button type="submit" class="timeframe_button" onclick="save_date()">Submit</button>
                </form>
            </div>

            <div id = "show_month_all_buttons">
                <a class="timeframe_button" href="/all">Show All</a>
            </div>
        </div>


    <!--    DATA FOR CURRENT MONTH ONLY       -->

    {% if  month_stats.total_tips  >= 1 %}
        <div id ="all_month_data_div">
            <div class ="month_title">{{ month_stats.month }}</div>
            <div class ="tip_total_title">Total Tips: {{ month_stats.total_tips }}</div>
            <div id ="both_boxes_display_flex">
                <div id="tip_data" class = "box_display_flex">
                    <div>
                        <p class = "data_title">Sent Tips<p> 
                        <p class = "data_numbers">{{ month_stats.sent_tips }} <span class = "percent"> {{ month_stats.sent_percentage }}</span></p>
                    </div>
                    <div>
                        <p class = "data_title">Claimed</p> 
                        <p class = "data_numbers">{{ month_stats.claimed_tips }} <span class = "percent"> {{ month_stats.claimed_percentage }}</span></p>
                    </div>
                    <div>
                        <p class = "data_title">Unclaimed</p>
                        <p class = "data_numbers">{{ month_stats.claim_waiting }}  <span class = "percent"> {{ month_stats.claim_waiting_percent }}</span> </p>
                    </div>
                    <div>
                        <p class = "data_title">Returned</p> 
                        <p class = "data_numbers">{{ month_stats.returned_tips }} <span class = "percent"> {{ month_stats.returned_percentage }}</span></p>
                    </div>
                </div>
                <div id = "price_data" class = "box_display_flex">
                        <div>
                        <p class = "data_title">Tip Total (BCH)</p>
                        <p class = "data_numbers">{{ month_stats.total_BCH|floatformat:8 }}</p>
                    </div>
                    <div>
                        <p class = "data_title">Tip Total (USD)</p>
                        <p class = "data_numbers">${{ month_stats.total_USD|floatformat:2 }}</p>
                    </div>

                    <div>
                        <p class = "data_title">Tip Total (USD) <span class = "percent">(current)</span></p>
                        <p class = "data_numbers">${{ month_stats.total_USD_current|floatformat:2 }}</p>
                    </div>
                    <div>
                        <p class = "data_title">BCH Price <span class = "percent">(current)</span> </p>
                        <p class = "data_numbers">${{ month_stats.bch_price|floatformat:2 }}</p>
                    </div>
                </div>
            </div>


            <div class="charts_flex">
                {{ month_stats.month_comparison_data|json_script:"month_comparison" }}
                <div class = "canvas_chart">
                    <canvas id="month_comparison_chart"></canvas>
                </div>
                <div class = "canvas_chart">
                    <canvas id="month_comparison_chart_value"></canvas>
                </div>
            </div>

            <div class="charts_flex">
                {{ month_stats.tip_per_day_result|json_script:"month_stats_tip_per_day" }}
                <div class = "canvas_chart">
                    <canvas id="month_tip_per_day"></canvas>
                </div>

                {{ month_stats.value_per_day_result|json_script:"month_stats_value_per_day" }}
                <div class = "canvas_chart">
                    <canvas id="month_value_per_day"></canvas>
                </div>
            </div>

            <div class="charts_flex">
                <div class = "canvas_chart">
                    <canvas id="month_comparison_chart_claimed"></canvas>
                </div>
                {{ month_stats.total_claimed_returned|json_script:"month_stats_total_claimed_returned" }}
                <div class = "canvas_chart">
                    <canvas id="month_total_claimed_returned"></canvas>
                </div>
            </div>


            <div class = "all_table_divs">
                <div id = "tipper_table_div" class="stat_table_div">
                    <p class = "table_title">Tippers  <span class = "percent">(# of tips)</span></p>
                    <table id="month_tipper_table" class="data_table base_table_style">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Tipper</th>
                                <th>Tips</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for tipper,tip in month_stats.all_senders %}
                                <tr>
                                    <td>{{ forloop.counter }}</td>
                                    <td><a href='https://reddit.com/{{ tipper }}'>{{ tipper }}</a></td>
                                    <td>{{ tip }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <div id = "receiver_table_div" class="stat_table_div">
                    <p class = "table_title">Recipients  <span class = "percent">(# of tips)</span></p>
                    <table id="month_receiver_table" class="data_table base_table_style">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Recipient</th>
                                <th>Tips</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for recipient,tip in month_stats.all_receivers %}
                                <tr>
                                    <td>{{ forloop.counter }}</td>
                                    <td><a href='https://reddit.com/{{ recipient }}'>{{ recipient }}</a></td>
                                    <td>{{ tip }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <div id = "sub_table_div" class="stat_table_div">
                    <p class = "table_title">Subreddits  <span class = "percent">(# of tips)</span></p>
                    <table id="month_sub_table" class="data_table base_table_style">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Subreddit</th>
                                <th>Tips</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for sub,tip in month_stats.all_subs %}
                                <tr>
                                    <td>{{ forloop.counter }}</td>
                                    <td><a href='https://reddit.com/r/{{ sub }}'>{{ sub }}</a></td>
                                    <td>{{ tip }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class = "all_table_divs">
                <div class="stat_table_div">
                    <p class = "table_title">Tippers  <span class = "percent">(value of tips)</span></p>
                    <table id="month_tipper_table" class="data_table base_table_style">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Tipper</th>
                                <th>BCH</th>
                                <th>USD</th>
                                <th>USD (current)</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for tipper, tipper_values in month_stats.sender_amount.items %}
                                <tr>
                                    <td>{{ forloop.counter }}</td>
                                    <td><a href='https://reddit.com/{{ tipper }}'>{{ tipper }}</a></td>
                                    <td>{{ tipper_values.bch|floatformat:8 }}</td>
                                    <td>${{ tipper_values.usd|floatformat:2 }}</td>
                                    <td>${{ tipper_values.usd_current|floatformat:2 }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="stat_table_div">
                    <p class = "table_title">Tippers  <span class = "percent">(Unique subreddits)</span></p>
                    <table id="month_tipper_table" class="data_table base_table_style">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Tipper</th>
                                <th>Unique subs</th>
                                <th>Subreddits</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for tipper, data in month_stats.senders_by_subs.items %}
                                <tr>
                                    <td>{{ forloop.counter }}</td>
                                    <td><a href='https://reddit.com/{{ tipper }}'>{{ tipper }}</a></td>
                                    <td>{{ data.subs_len }}</td>
                                    <td class ="subreddit_list">{{ data.subs | join:", "}} </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="all_tip_table_div" class = "stat_table_div">
                <table id="all_tip_table" class="data_table base_table_style">
                <div id = "title and button">
                    <div>
                        <p class = "table_title">All Tips - {{ month_stats.month }}</p>
                    </div>
                    <div id = "export">
                        <a class = "timeframe_button" href="/export">EXPORT to CSV</a>
                    </div>
                </div>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Sender</th>
                            <th>Receiver</th>
                            <th>Subreddit</th>
                            <th>BCH</th>
                            <th>USD</th>
                            <th>Status</th>
                            <th>Created (UTC)</th>
                            <th>BCH TX</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for tip in all_month_tips %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td><a href='https://reddit.com/{{ tip.sender }}'>{{ tip.sender }}</a></td>
                                <td><a href='https://reddit.com/{{ tip.receiver }}'>{{ tip.receiver }}</a></td>
                                <td><a href='{{ tip.parent_comment_permalink }}'>{{ tip.subreddit }}</a></td>
                                <td>{{ tip.coin_amount|floatformat:8 }}</td>
                                <td>${{ tip.fiat_value|floatformat:2 }}</td>
                                <td>{{ tip.status }}</td>
                                <td>{{ tip.created_datetime }}</td>
                                <td><a href='{{tip.blockchain_tx}}'>{{ tip.blockchain_tx }}</a></td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    {% else %}
        <div id="all_month_data_div">
            <div class ="tip_total_title">{{ month_stats.month }}</div>
            <div class ="month_title"><p style="font-style:italic">There aren't any tips yet this month.</p></div>
            <div class ="month_title"><p style="font-style:italic"><a href="https://www.chaintip.org/reddit" target=_blank> Start Tipping</a> to generate data!</p></div>
        </div>
    {% endif %}

{% endblock %}